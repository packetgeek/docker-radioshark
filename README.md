# docker-radioshark

This is my Dockerized control for RadioShark v1 (unknown if it'll work for v2).  It's currently being tweaked but appears to work.

## Tweaks
- The code is based on the older libhid-devel package, which was last supported in Fedora 25 (thus the older distro is being used to host the binary).
- The code is slightly modified to work-around some warnings generated by the newer (at the time) version of GCC.
- There's still some tweaking needed to get PulseAudio to recognize the new source.  Notes on work-around are below.

## Building the image
Run the following:

```c
git clone https://github.com/packetgeek/docker-radioshark/
cd docker-radioshark
docker build -t pg/shark .
```

## Command line for running the code:

```c
#!/usr/bin/perl
$freq=$ARGV[0];
system("sudo docker run --rm --privileged shark /shark-1.0/bin/linux/x86_64/shark -fm $freq");
```

The above causes a temporary container to be created, and calls the binary with the desired frequency.  If you want to listen to AM radio, change the "-fm" to "-am".  If you want to control the blue LEDs, change "-fm" to "-blue" followed by a "1" or "0".  If you want to control the red LEDs, change the "-fm" to "-red", followed by a "1" or "0". Example: "-red 1".  Note: the LED calls can be run in the same command line as the "-fm" or "-am" calls.

## Getting Pulseaudio to play the audio

One you plug in the RadioShark, Pulseaudio should recognize it as an audio source.  However, the GUI for PulseAudio doesn't always list it.  You can force the issue by determining the appropriate sink and source numbers for the devices.

Find the sink number by running:

```text
pactl list|grep "Sink \#" -A 3
```

The output should look something like:

```text
root@desk:~# pactl list|grep "Sink \#" -A 3
Sink #0
	State: IDLE
	Name: alsa_output.pci-0000_01_00.1.hdmi-stereo
	Description: Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] Digital Stereo (HDMI)
--
Sink #1
	State: IDLE
	Name: alsa_output.usb-Samson_Technologies_Samson_Meteor_Mic-00.analog-stereo
	Description: Meteor condenser microphone Analog Stereo
--
Sink #2
	State: RUNNING
	Name: alsa_output.pci-0000_00_14.2.analog-stereo
	Description: Built-in Audio Analog Stereo
```

In the above example, Sink #2 is connected to the sound bar on my desk.

The source number can be determined by running:

```text
pactl list|grep "Sink \#" -A 3
```

The output should look something like:

```text
root@desk:~# pactl list|grep "Source \#" -A 3
Source #0
	State: RUNNING
	Name: alsa_output.pci-0000_01_00.1.hdmi-stereo.monitor
	Description: Monitor of Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] Digital Stereo (HDMI)
--
Source #1
	State: RUNNING
	Name: alsa_input.usb-Griffin_Technology__Inc._RadioSHARK-00.analog-stereo
	Description: Radio SHARK Analog Stereo
--
Source #2
	State: RUNNING
	Name: alsa_output.usb-Samson_Technologies_Samson_Meteor_Mic-00.analog-stereo.monitor
	Description: Monitor of Meteor condenser microphone Analog Stereo
--
```

In the above, the RadioShark is source #1.

We can then configure Pulseaudio to recognize the RadioShark and pipe it's output to the soundbar by running:

```
pactl load-module module-loopback source=1 sink=2
```

The above causes the proper controls to show up in the pavucontrol GUI.  I'll develop a more permanent solution in the future.

The RadioShark can then be tuned by running the above command line.
